{% set page_bubble = get_current_page_bubble(request.path).page_bubble %}

{% block header_banner %}
  <header id="navigation"
          class="p-navigation--sliding is-dark {% if page_bubble and page_bubble.children or page_bubble.grandchildren %}is-reduced p-navigation--reduced {% else %}is-sticky{% endif %} js-enabled">
    <div class="p-navigation__row--25-75">
      <div class="p-navigation__banner">
        <div class="p-navigation__tagged-logo">
          <a class="p-navigation__link" href="/">
            {% if page_bubble and page_bubble.children or page_bubble.grandchildren %}
              Canonical Ubuntu
            {% else %}
              <div class="p-navigation__logo-tag">
                <img class="p-navigation__logo-icon"
                     src="https://assets.ubuntu.com/v1/82818827-CoF_white.svg"
                     alt="" />
              </div>
              <span class="p-navigation__logo-title">Canonical Ubuntu</span>
            {% endif %}
          </a>
        </div>
        <div>
          <a href="#navigation"
             class="p-navigation__toggle--open js-menu-button"
             title="menu">Menu</a>
          <button href="#navigation-closed"
                  class="p-navigation__toggle--close js-menu-button"
                  title="close menu">Close menu</button>
        </div>
      </div>
      <nav class="p-navigation__nav js-show-nav" role="menubar">
        <ul class="p-navigation__items js-navigation-items global-nav"
            role="menu">
          <li class="p-navigation__item" role="menuitem">
            <a class="p-navigation__link"
               href="/internet-of-things"
               onclick='dataLayer.push({ event: "GAEvent", eventCategory: "Primary navigation", eventAction: "from:" + window.location.href + " to: /internet-of-things", eventLabel: "IoT", eventValue: undefined, });'>物联网</a>
          </li>
          <li class="p-navigation__item" role="menuitem">
            <a class="p-navigation__link"
               href="/infrastructure"
               onclick='dataLayer.push({ event: "GAEvent", eventCategory: "Primary navigation", eventAction: "from:" + window.location.href + " to: /infrastructure", eventLabel: "Infrastructure", eventValue: undefined, });'>基础架构</a>
          </li>
          <li class="p-navigation__item" role="menuitem">
            <a class="p-navigation__link"
               href="/ai"
               onclick='dataLayer.push({ event: "GAEvent", eventCategory: "Primary navigation", eventAction: "from:" + window.location.href + " to: /ai", eventLabel: "AI", eventValue: undefined, });'>开源 AI</a>
          </li>
          <li class="p-navigation__item" role="menuitem">
            <a class="p-navigation__link"
               href="/enterprise"
               onclick='dataLayer.push({ event: "GAEvent", eventCategory: "Primary navigation", eventAction: "from:" + window.location.href + " to: /enterprise", eventLabel: "Enterprise", eventValue: undefined, });'>产品和支持</a>
          </li>
          <li class="p-navigation__item" role="menuitem">
            <a class="p-navigation__link"
               href="/desktop"
               onclick='dataLayer.push({ event: "GAEvent", eventCategory: "Primary navigation", eventAction: "from:" + window.location.href + " to: /desktop", eventLabel: "Desktop", eventValue: undefined, });'>桌面系统</a>
          </li>
          <li class="p-navigation__item" role="menuitem">
            <a class="p-navigation__link"
               href="/server"
               onclick='dataLayer.push({ event: "GAEvent", eventCategory: "Primary navigation", eventAction: "from:" + window.location.href + " to: /server", eventLabel: "Server", eventValue: undefined, });'>服务器</a>
          </li>
          <li class="p-navigation__item" role="menuitem">
            <a class="p-navigation__link"
               href="/download"
               onclick='dataLayer.push({ event: "GAEvent", eventCategory: "Primary navigation", eventAction: "from:" + window.location.href + " to: /download", eventLabel: "Download", eventValue: undefined, });'>下载</a>
          </li>
          <li class="p-navigation__item" role="menuitem">
            <a class="p-navigation__link"
               href="/blog"
               onclick='dataLayer.push({ event: "GAEvent", eventCategory: "Primary navigation", eventAction: "from:" + window.location.href + " to: /blog", eventLabel: "Blog", eventValue: undefined, });'>博客</a>
          </li>
        </ul>
        <span class="u-off-screen">
          <a href="#main-content">Jump to main content</a>
        </span>
      </nav>
    </div>
  </header>

  {% if page_bubble and page_bubble.children or page_bubble.grandchildren %}
    <div id="secondary-navigation"
         class="p-navigation is-sticky is-secondary is-dark">
      <div class="p-navigation__row--25-75">
        <div class="p-navigation__banner">
          <div class="p-navigation__tagged-logo">
            <a class="p-navigation__link" href="{{ page_bubble.path }}">
              <div class="p-navigation__logo-tag">
                <img class="p-navigation__logo-icon"
                     src="https://assets.ubuntu.com/v1/82818827-CoF_white.svg"
                     alt="" />
              </div>
              <span class="p-navigation__logo-title">{{ page_bubble.title | replace(' ', '&nbsp;') | safe }}</span>
            </a>
          </div>
          {% if page_bubble.children %}
            {% if not (page_bubble.children | length == 1 and page_bubble.children[0].title == "Overview") %}
              <a href="#"
                 class="p-navigation__toggle--open js-secondary-menu-toggle-button"
                 title="Toggle navigation"><i class="p-icon--chevron-down is-light"></i></a>
            {% endif %}
          {% endif %}
        </div>

        <nav class="p-navigation__nav js-show-nav"
             aria-label="{{ page_bubble.title | replace(' ', '&nbsp;') | safe }} navigation">
          {% if page_bubble.children %}
            <ul class="p-navigation__items">
              {% for child in page_bubble.children %}
                {% if child.title != "Overview" %}
                  {% set has_access = not child.login_required or child.login_required and user_info %}
                  {% if has_access %}
                    <li class="p-navigation__item {% if child.active %}is-selected{% endif %}">
                      <a class="p-navigation__link"
                         href="{{ child.path }}"
                         {% if child.active %}aria-current="page"{% endif %}>{{
                      child.title }}</a>
                    </li>
                  {% endif %}
                {% endif %}
              {% endfor %}
            </ul>
          {% endif %}
        </nav>
      </div>
    </div>
  {% endif %}

  <style>
    .p-navigation__items {
      width: 100%;
    }

    .p-navigation__items>li#all-canonical {
      margin-left: auto;
    }
  </style>
{% endblock header_banner %}
